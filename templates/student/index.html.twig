{% extends 'base.html.twig' %}

{% block body %}

	<!-- Begin page -->
	<div id="layout-wrapper">

		{{ include('partials/menu.html.twig') }}

		<!-- ============================================================== -->
		<!-- Start right Content here -->
		<!-- ============================================================== -->
			<div class="main-content"> <div class="page-content">
				<div class="container-fluid">

					{{ include('partials/page-title.html.twig', {pagetitle: 'Dashboard', title: 'Student List', backLink: {
        url: path('app_dashboard'),
        label: 'Back to Dashboard'
    }}) }}

					<div class="row">
						<div class="col-lg-12">
							<div class="card">
								<div class="card-body">
									<div class="row mb-2">
										<div
											class="col-md-6">
											{# <div class="mb-3">
																																												                                                    <a href="{{ path('app_student_new') }}" class="btn btn-success waves-effect waves-light"><i class="mdi mdi-plus me-2"></i> Add New</a>
																																												                                                </div> #}
											<button type="button" class="btn btn-success waves-effect waves-light" data-bs-toggle="modal" data-bs-target=".bs-example-modal-xl">Add Student</button>
											<!--  Extra Large modal example -->
											<div class="modal fade bs-example-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
												<div class="modal-dialog modal-xl">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="myExtraLargeModalLabel">Add New Student</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body">
															<div class="col-lg-12 ms-lg-auto">
																<div class="mt-5 mt-lg-4">
																	{{ form_start(form, {'attr': {'class': 'needs-validation'}}) }}

																	<div class="row mb-4">
																		{{ form_label(form.studentNumber, 'Student Number', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
																		<div class="col-sm-9">
																			{{ form_widget(form.studentNumber, {'attr': {'class': 'form-control', 'placeholder': 'Enter Student Number'}}) }}
																			{{ form_errors(form.studentNumber) }}
																		</div>
																	</div>

																	<div class="row mb-4">
																		{{ form_label(form.name, 'Student Full Name', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
																		<div class="col-sm-9">
																			{{ form_widget(form.name, {'attr': {'class': 'form-control', 'placeholder': 'Enter Student Name'}}) }}
																			{{ form_errors(form.name) }}
																		</div>
																	</div>

																	<div class="row mb-4">
																		{{ form_label(form.course, 'Course', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
																		<div class="col-sm-9">
																			{{ form_widget(form.course, {'attr': {'class': 'form-control', 'placeholder': 'Enter Student Course'}}) }}
																			{{ form_errors(form.course) }}
																		</div>
																	</div>

																	<div class="row mb-4">
																		{{ form_label(form.section, 'Section', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
																		<div class="col-sm-9">
																			{{ form_widget(form.section, {'attr': {'class': 'form-control', 'placeholder': 'Enter Student Section'}}) }}
																			{{ form_errors(form.section) }}
																		</div>
																	</div>

																	<button class="btn btn-primary">Add Student</button>

																	{{ form_end(form) }}
																</div>
															</div>

														</div>
													</div>
													<!-- /.modal-content -->
												</div>
												<!-- /.modal-dialog -->
											</div>
											<!-- /.modal -->
										</div>

										<div class="col-md-6">
											<div class="form-inline float-md-end mb-3">
												<div class="search-box ms-2">
													<div class="position-relative">
														<input type="text" id="studentSearch" class="form-control rounded bg-light border-0" placeholder="Search...">
														<i class="mdi mdi-magnify search-icon"></i>
													</div>
												</div>

											</div>
										</div>


									</div>
									<!-- end row -->
									<div class="table-responsive mb-4">
										<table class="table table-centered table-nowrap mb-0">
											<thead>
												<tr>
													<th scope="col" style="width: 50px;">
														<div class="form-check font-size-16">
															<input type="checkbox" class="form-check-input" id="contacusercheck">
															<label class="form-check-label" for="contacusercheck"></label>
														</div>
													</th>
													<th scope="col">Student Number</th>
													<th scope="col">Name</th>
													<th scope="col">Course</th>
													<th scope="col">Section</th>
													<th scope="col" style="width: 200px;">Actions</th>
												</tr>
											</thead>
											<tbody>
												{% for students in students %}
													<tr>
														<th scope="row">
															<div class="form-check font-size-16">
																<input type="checkbox" class="form-check-input" id="contacusercheck1">
																<label class="form-check-label" for="contacusercheck1"></label>
															</div>
														</th>
														<td>
															<a href="#" class="text-body">{{ students.studentNumber }}</a>
														</td>
														<td>{{ students.name }}</td>
														<td>{{ students.course }}</td>
														<td>{{ students.section }}</td>
														<td>
															{# <a href="{{ path('app_student_qr', { id: students.id }) }}" target="_blank" class="text-body uil-eye font-size-18">
																																																												                                                            <span class="font-size-12">View QR Code</span>
																																																												                                                            Uncomment the line below to display the QR code image
																																																												                                                            <img src="{{ path('app_student_qr', {id: students.id}) }}" alt="QR Code" width="100">
																																																												                                                            </a> #}
															<button type="button" class="btn btn-success view-student-btn" data-id="{{ students.id }}" data-bs-toggle="modal" data-bs-target=".student_profile_modal">
																View Student
															</button>
															<button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editModal{{ students.id }}">
																Edit
															</button>
														</td>
													</tr>
												{% endfor %}
											</tbody>
										</table>
									</div>
									<!-- Edit Modal -->
									{% for students in students %}
										<div class="modal fade" id="editModal{{ students.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ students.id }}" aria-hidden="true">
											<div class="modal-dialog modal-lg">
												<div class="modal-content">
													{% if editForms[students.id].vars.errors|length > 0 %}
														<div class="alert alert-danger">
															{{ form_errors(editForms[students.id]) }}
														</div>
													{% endif %}
													{{ form_start(editForms[students.id]) }}
													<div class="modal-header">
														<h5 class="modal-title" id="editModalLabel{{ students.id }}">Edit Student</h5>
														<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														<div class="row mb-4">
															{{ form_label(editForms[students.id].studentNumber, 'Student Number', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
															<div class="col-sm-9">
																{{ form_widget(editForms[students.id].studentNumber, {'attr': {'class': 'form-control'}}) }}
																{{ form_errors(editForms[students.id].studentNumber) }}
															</div>
														</div>
														<div class="row mb-4">
															{{ form_label(editForms[students.id].name, 'Student Name', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
															<div class="col-sm-9">
																{{ form_widget(editForms[students.id].name, {'attr': {'class': 'form-control'}}) }}
																{{ form_errors(editForms[students.id].name) }}
															</div>
														</div>
														<div class="row mb-4">
															{{ form_label(editForms[students.id].course, 'Student Course', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
															<div class="col-sm-9">
																{{ form_widget(editForms[students.id].course, {'attr': {'class': 'form-control'}}) }}
																{{ form_errors(editForms[students.id].course) }}
															</div>
														</div>
														<div class="row mb-4">
															{{ form_label(editForms[students.id].section, 'Student Section', {'label_attr': {'class': 'col-sm-3 col-form-label'}}) }}
															<div class="col-sm-9">
																{{ form_widget(editForms[students.id].section, {'attr': {'class': 'form-control'}}) }}
																{{ form_errors(editForms[students.id].section) }}
															</div>
														</div>
														{# {{ form_row(editForms[students.id].name) }}
																																																								                                                                        {{ form_row(editForms[students.id].course) }}
																																																								                                                                        {{ form_row(editForms[students.id].section) }}
																																																								                                                                        {{ form_row(editForms[students.id].studentNumber) }} #}
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
														<button type="submit" class="btn btn-primary">Save changes</button>
													</div>
													{{ form_end(editForms[students.id]) }}
												</div>
											</div>
										</div>
									{% endfor %}
									<!--  Student Profile modal example -->
									<div id="student-profile-modal">
										<div class="modal fade student_profile_modal" tabindex="-1" role="dialog" aria-labelledby="student_profile_modal" aria-hidden="true">
											<div class="modal-dialog modal-lg">
												<div class="modal-content printable-pdf">
													<div class="modal-header">
														<h5 class="modal-title" id="student_profile_modal">Student Profile</h5>
														<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														<div class="col-lg-12 ms-lg-auto">
															<div class="mt-2 mt-lg-12">
																<div class="col-xl-12">
																	<div class="card h-100">
																		<div class="card-body">
																			<div class="row">
																				<div class="text-left col-xl-6">
																					<div class="clearfix"></div>
																					<div>
																						<img src="/images/users/avatar-default.jpg" alt="" class="avatar-lg rounded-circle img-thumbnail">
																					</div>
																					<h5 class="mt-3 mb-2" id="modalStudentName">Student Name</h5>
																					<p class="text-muted">Student Number:
																						<span id="modalStudentNumber"></span>
																					</p>
																					<div class="text-muted">
																						<h5 class="font-size-16">Expertise</h5>
																						<p>Hi I'm Marcus,has been the industry's standard dummy text To an English person, it will seem like simplified English, as a skeptical Cambridge.</p>
																						<div class="table-responsive mt-4">
																							<div>
																								<p class="mb-1">Course :</p>
																								<h5 class="font-size-16">
																									<span id="modalStudentCourse"></span>
																								</h5>
																							</div>
																							<div class="mt-4">
																								<p class="mb-1">Section :</p>
																								<h5 class="font-size-16">
																									<span id="modalStudentSection"></span>
																								</h5>
																							</div>
																						</div>
																					</div>
																				</div>

																				<div class="text-center col-xl-6 m-auto">
																					<div class="clearfix"></div>
																					<div>
																						<img src="" id="modalStudentQr" alt="QR Code">
																					</div>
																				</div>
																			</div>

																			{# <hr class="my-4"> #}

																			{# <div class="text-muted">
																																																																												                                                                                <h5 class="font-size-16">Expertise</h5>
																																																																												                                                                                <p>Hi I'm Marcus,has been the industry's standard dummy text To an English person, it will seem like simplified English, as a skeptical Cambridge.</p>
																																																																												                                                                                <div class="table-responsive mt-4">
																																																																												                                                                                    <div>
																																																																												                                                                                        <p class="mb-1">Course :</p>
																																																																												                                                                                        <h5 class="font-size-16"><span id="modalStudentCourse"></span></h5>
																																																																												                                                                                    </div>
																																																																												                                                                                    <div class="mt-4">
																																																																												                                                                                        <p class="mb-1">Section :</p>
																																																																												                                                                                        <h5 class="font-size-16"><span id="modalStudentSection"></span></h5>
																																																																												                                                                                    </div>
																																																																												                                                                                </div>
																																																																												                                                                            </div> #}
																		</div>
																	</div>
																</div>
															</div>
														</div>
														<button class="btn btn-success" id="download_button" onclick="downloadProfilePDF()">Download Profile</button>
													</div>
												</div>
												<!-- /.modal-content -->
											</div>
											<!-- /.modal-dialog -->
										</div>
										<!-- /.modal -->
									</div>
									<div class="row mt-4">
										<div class="col-sm-6">
											<div>
												<p class="mb-sm-0">Showing 1 to 10 of 12 entries</p>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="float-sm-end">
												<ul class="pagination mb-sm-0 ">
													<li class="page-item disabled">
														<a href="#" class="page-link">
															<i class="mdi mdi-chevron-left"></i>
														</a>
													</li>
													<li class="page-item">
														<a href="#" class="page-link">1</a>
													</li>
													<li class="page-item active">
														<a href="#" class="page-link">2</a>
													</li>
													<li class="page-item">
														<a href="#" class="page-link">3</a>
													</li>
													<li class="page-item">
														<a href="#" class="page-link">
															<i class="mdi mdi-chevron-right"></i>
														</a>
													</li>
												</ul>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- end row -->

				</div>
				<!-- container-fluid -->
			</div>
			<!-- End Page-content -->


			{# {{ include('partials/footer.html.twig') }} #}
		</div>
		<!-- end main content-->

	</div>
	<!-- END layout-wrapper -->

	{{ include('partials/right-sidebar.html.twig') }}

	{{ include('partials/vendor-scripts.html.twig') }}

	<!-- App js -->
	<script src="/js/app.js"></script>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
document.querySelectorAll('.view-student-btn').forEach(button => {
button.addEventListener('click', () => {
const studentId = button.getAttribute('data-id');

fetch (`/student/${studentId}/json`).then(response => response.json()).then(data => {
document.getElementById('modalStudentName').textContent = data.name;
document.getElementById('modalStudentNumber').textContent = data.studentNumber;
document.getElementById('modalStudentCourse').textContent = data.course;
document.getElementById('modalStudentSection').textContent = data.section;
document.getElementById('modalStudentQr').setAttribute('src', data.qr);

}).catch(err => {
console.error('Failed to fetch student data:', err);
});
});
});
});
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

	<script>
		function downloadProfilePDF() {
const studentName = document.querySelector('#modalStudentName') ?. textContent.trim() || 'student_profile';
const safeFileName = studentName.replace(/[^\w\s-]/g, '').replace(/\s+/g, '_');
const modalContent = document.querySelector('.printable-pdf');
const downloadButton = document.getElementById('download_button');

// Temporarily hide the button in the live DOM
if (downloadButton) 
downloadButton.style.display = 'none';



const options = {
margin: 0.5,
filename: `${safeFileName}_profile.pdf`,
image: {
type: 'jpeg',
quality: 0.98
},
html2canvas: {
scale: 2
},
jsPDF: {
unit: 'in',
format: [
11, 6.5
],
orientation: 'landscape'
}
};

setTimeout(() => {
html2pdf().set(options).from(modalContent).save().then(() => { // Show the button again after saving the PDF
if (downloadButton) 
downloadButton.style.display = '';



});
}, 300);
}
	</script>

	<script>
		document.getElementById('studentSearch').addEventListener('keyup', function () {
const searchTerm = this.value.toLowerCase();
const rows = document.querySelectorAll('.table tbody tr');

rows.forEach(row => { // Combine text from all columns into a single string
const rowText = row.textContent.toLowerCase();

// Show the row if it contains the search term, else hide it
if (rowText.includes(searchTerm)) {
row.style.display = '';
} else {
row.style.display = 'none';
}
});
});
	</script>


{% endblock %}
